<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />

		<title>index</title>

		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="css/all.css" />
		<style>
		body{height: 100%;width: 100%;margin: 0;padding: 0;}
		input{border: none;}
		body{content: "";z-index: 1;background-image:url(img/3.png);background-size:cover;position: absolute;height: 100vh;width: 100vw;margin: 0;padding: 0;}
		
		</style>
	</head>
	<body>

		<div class="con" style="display: flex;flex-direction: column;">

				<div id="head" style="display: flex;flex-direction: column;">
						<div class="head_box1" style="z-index: 5;"><img  src="img/app.png" style="height: 188.1px;width:188.1px"/></div>
						<div class="head_box2" style="z-index: 5;">工大助手</div>
						<div class="head_box3" style="z-index: 5;">厚德博学&nbsp;和而不同</div>
				</div>		

				<div id="section" style="display: flex;flex-direction: column;">
					<div class="section_box" style="z-index: 5;">
						<div class="section_icon"><i class="fa fa-user fa-4x"></i></div>
						<input id="index_input1" class="section_input"></input>						
					</div>					
					<div class="section_box" style="z-index: 5;">
						<div class="section_icon"><i class="fa fa-lock fa-4x"></i></div>
						<input id="index_input2" class="section_input" type="password"></input>	
					</div>						
					<button class="section_sure "style="z-index: 5;">
						登录
					</button>			
				</div>

		
		</div>
		<script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
		<script type="text/javascript" src="js/bootstrap.min.js" ></script>
		<script type="text/javascript" src="jsencrypt-master/bin/jsencrypt.min.js" ></script>
		<script type="text/javascript" src="js/sha1&cookie.js" ></script>
		<script>
		//检测是否已经有登陆信息
		window.onload=function(){
		if($.cookie('sign')){			
					window.location.href='home.html';
					};
				
		}
		//没有登陆信息的情况下
		$(".section_sure").click(function(){
			var stuId = $("#index_input1").val();
			var stuPass = $("#index_input2").val();
			var encrypt = new JSEncrypt();
			encrypt.setPublicKey("-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZ1T65TCvVK+vndaRgeE7PhLS+vYdNNMTjCD1WO1eRFqBuTM5rMP7h3Hq+jsTicFh1/FoPRjwvlWhuCXZi6IqjphvVvXZso74xhNLA8Lml750qkkyaDKD5Pr2PGIaJ6h4WKvt7sBhDQ6LZQcz83Disp1frgtWhPytyJr7D1I4DvwIDAQAB-----END PUBLIC KEY-----");
			var encryptData =encrypt.encrypt(stuPass);
			
			
			console.log(encryptData);
			
			
			
			$.ajax({
				    url:'https://api.huthelper.cn/api/v3/Get/login/4', //请求地址
				    type:'POST',   //请求方式
				    data:{"studentkh":stuId,"passwd":stuPass}, //请求参数
				    async : true, 
				    crossDomain: true,
				    dataType:"json"     // 返回值类型的设定
				}).done(function(res) {
					console.log("链接成功");
					console.log(res);
				    var sign = 1;
					$.cookie('sign',sign,{expires:30});
				
					$.cookie('userData' , JSON.stringify(res),{expires:30});//缓存
					
					if(res.code==200)
					window.location.href='home.html';
					else if(res.code==400)
					alert("信息不能为空");
					else if(res.code==301)
					alert("您的账号有误");
					else if(res.code==302)				
					alert("此用户被限制");
					else if(res.code==303)
					alert("多次失败，请稍后再试，或修改密码");
					else if(res.code==304)
					alert("您的密码有误");
					else alert("其他错误，请联系相关负责人员予以解决");
						}).fail(function(res) {
							console.log("链接错误");
						});
		});
		
		</script>
	</body>
</html>
